<!-- assets/parse-lab.html -->
<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transcript Parser - IRS Transcript Automation</title>

  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['DM Sans', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial']
          }
        }
      }
    };
  </script>

  <!-- PDF.js (may be blocked by CSP/extensions; we also dynamically load fallbacks at runtime) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.js"></script>
  <script>
    if (typeof window.pdfjsLib !== 'undefined') {
      window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.js';
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      min-height: 100%;
      font-family: 'DM Sans', system-ui, sans-serif;
    }

    .container-wrapper {
      width: 100%;
      height: 100%;
      overflow-y: auto;
      background: linear-gradient(to bottom, #0f172a, #1e293b);
    }

    .report-page {
      width: 100%;
      max-width: 8.5in;
      margin: 0 auto 24px;
      background: #ffffff;
      box-shadow: 0 4px 20px rgba(0,0,0,.10);
      border-radius: 12px;
      overflow: hidden;
    }

    .report-content {
      padding: 52px;
      color: #0b0a14;
      font-family: 'DM Sans', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 40px;
      padding-bottom: 18px;
      border-bottom: 2px solid #0b0a14;
    }

    .report-h1 {
      font-size: 30px;
      font-weight: 800;
      letter-spacing: -0.5px;
      line-height: 1.1;
    }

    .report-kicker {
      font-size: 12px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 700;
      margin-top: 6px;
    }

    .report-section { margin-bottom: 34px; }

    .report-title {
      font-size: 13px;
      font-weight: 800;
      color: #0b0a14;
      text-transform: uppercase;
      letter-spacing: .5px;
      margin-bottom: 14px;
      padding-left: 10px;
      border-left: 4px solid #7c3aed;
    }

    .report-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .report-block {
      background: #f9fafb;
      padding: 14px;
      border-radius: 10px;
      border-left: 3px solid #7c3aed;
    }

    .report-label {
      font-size: 11px;
      font-weight: 700;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: .5px;
      margin-bottom: 6px;
    }

    .report-value {
      font-size: 16px;
      font-weight: 700;
      color: #0b0a14;
    }

    .report-status {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .report-card {
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      padding: 18px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      text-align: center;
    }

    .report-stat {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 6px;
      min-height: 26px;
    }

    .report-stat.low { color: #059669; }
    .report-stat.moderate { color: #d97706; }
    .report-stat.attention { color: #dc2626; }

    .report-stat-label {
      font-size: 11px;
      font-weight: 800;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .report-summary {
      background: rgba(124,58,237,.08);
      border-left: 4px solid #7c3aed;
      padding: 18px;
      border-radius: 10px;
      line-height: 1.7;
      color: #374151;
      font-size: 14px;
    }

    .report-footer {
      margin-top: 40px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      gap: 16px;
      font-size: 11px;
      color: #9ca3af;
    }

    @media (max-width: 640px) {
      .report-content { padding: 28px; }
      .report-grid { grid-template-columns: 1fr; }
      .report-status { grid-template-columns: 1fr; }
    }

    .fade-in { animation: fadeIn 0.5s ease-in; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse-ring { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    input[type="file"] { display: none; }

    .input-field {
      background: rgba(148, 163, 184, 0.1);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: white;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      background: rgba(148, 163, 184, 0.15);
      border-color: rgba(168, 85, 247, 0.5);
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
    }

    .input-field::placeholder { color: rgba(255, 255, 255, 0.5); }

    button:disabled {
      opacity: 0.5 !important;
      cursor: not-allowed !important;
    }

    .btn-primary {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
    }

    .btn-secondary {
      background: rgba(168, 85, 247, 0.1);
      color: #a855f7;
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 10px;
      padding: 12px 24px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(168, 85, 247, 0.2);
      border-color: rgba(168, 85, 247, 0.5);
    }

    .glass {
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.16);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .step-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      background: rgba(168, 85, 247, 0.2);
      border: 2px solid rgba(168, 85, 247, 0.4);
      border-radius: 50%;
      font-weight: 800;
      font-size: 16px;
      color: #a855f7;
      flex-shrink: 0;
    }

    .success-badge {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #10b981;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .drop-zone {
      border: 2px dashed rgba(168, 85, 247, 0.5);
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(168, 85, 247, 0.05);
    }

    .drop-zone:hover {
      border-color: rgba(168, 85, 247, 0.7);
      background: rgba(168, 85, 247, 0.08);
    }

    .drop-zone.active {
      border-color: #a855f7;
      background: rgba(168, 85, 247, 0.15);
    }
  </style>

  <!-- IMPORTANT: Do not include /_sdk/data_sdk.js unless that file exists.
       When it 404s, Pages often returns HTML, which the browser tries to parse as JS and throws:
       SyntaxError: Invalid or unexpected token / Unexpected token '<' -->
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
</head>

<body>
  <div class="container-wrapper">
    <main class="max-w-6xl mx-auto px-6 py-12">
      <!-- Hero Section -->
      <div class="text-center mb-12 fade-in">
        <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Parse Your Transcript in Seconds</h2>
        <p class="text-xl text-slate-300 max-w-2xl mx-auto">Upload an IRS transcript PDF. Get instant code extraction and a client-ready report. No uploads. No risk.</p>
      </div>

      <!-- Parser Card -->
      <div class="glass rounded-2xl p-8 mb-12 fade-in">
        <!-- Steps Indicator -->
        <div class="flex items-center justify-between mb-12 pb-8 border-b border-slate-700/50">
          <div class="flex items-center gap-3">
            <div class="step-number">1</div>
            <div>
              <div class="text-white font-semibold">Enter Token</div>
              <div class="text-sm text-slate-400">Verify access credits</div>
            </div>
          </div>

          <div class="hidden md:flex-1 h-px bg-gradient-to-r from-slate-700/0 via-slate-700/50 to-slate-700/0 mx-4"></div>

          <div class="flex items-center gap-3">
            <div class="step-number">2</div>
            <div>
              <div class="text-white font-semibold">Upload PDF</div>
              <div class="text-sm text-slate-400">Choose your transcript</div>
            </div>
          </div>

          <div class="hidden md:flex-1 h-px bg-gradient-to-r from-slate-700/0 via-slate-700/50 to-slate-700/0 mx-4"></div>

          <div class="flex items-center gap-3">
            <div class="step-number">3</div>
            <div>
              <div class="text-white font-semibold">Preview &amp; Download</div>
              <div class="text-sm text-slate-400">Get your report</div>
            </div>
          </div>
        </div>

        <!-- Step 1: Token Section -->
        <div class="mb-10 pb-10 border-b border-slate-700/30">
          <h3 class="text-lg font-semibold text-white mb-6 flex items-center gap-3">
            <span class="step-number text-sm">1</span> Enter Your API Token
          </h3>

          <div class="space-y-4">
            <div>
              <label for="parser-token-id" class="block text-sm font-medium text-slate-300 mb-2">API Token ID</label>
              <input id="parser-token-id" type="text" placeholder="Paste your token ID here" class="input-field w-full rounded-lg px-4 py-3" autocomplete="off" />
              <p class="text-xs text-slate-400 mt-2">Your token is never stored or transmitted. It only validates locally.</p>
            </div>

            <div class="flex items-center justify-between gap-4">
              <div class="text-sm text-slate-300">
                <span class="text-slate-400">Available credits:</span>
                <span id="parser-token-available" class="ml-2 font-semibold text-purple-400">-</span>
              </div>
              <button id="parser-save-token" type="button" class="btn-secondary text-sm px-4 py-2">Verify Token</button>
            </div>

            <div id="parser-token-status" class="text-xs text-slate-400 p-3 rounded-lg bg-slate-800/30 border border-slate-700/30">Enter a valid token to activate parsing.</div>
          </div>
        </div>

        <!-- Step 2: Upload Section -->
        <div class="mb-10 pb-10 border-b border-slate-700/30">
          <h3 class="text-lg font-semibold text-white mb-6 flex items-center gap-3">
            <span class="step-number text-sm">2</span> Upload Your Transcript
          </h3>

          <!-- Firm Logo Optional -->
          <div class="mb-8">
            <label class="block text-sm font-medium text-slate-300 mb-3">Firm Logo (Optional)</label>

            <label for="brand-logo" class="cursor-pointer inline-flex items-center gap-2 px-4 py-2 btn-secondary rounded-lg">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              <span>Choose Logo File</span>
            </label>

            <input id="brand-logo" type="file" accept="image/*" />
            <span id="brand-logo-file-name" class="text-sm text-slate-400 ml-3">No file selected</span>

            <p class="text-xs text-slate-500 mt-3">Recommended: 600Ã—600 PNG, SVG, or JPG</p>
          </div>

          <!-- PDF Drop Zone -->
          <div class="drop-zone fade-in" id="pdf-drop-zone">
            <svg class="w-16 h-16 text-purple-400 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
            </svg>
            <p class="text-white font-semibold mb-2">Drop IRS transcript PDF here</p>
            <p class="text-slate-400 text-sm">or click to browse</p>
            <p class="text-slate-500 text-xs mt-3">Supports Form 4506-C (Account, Return, Wage &amp; Income transcripts)</p>
          </div>
          <input id="pdf-upload" type="file" accept="application/pdf" class="hidden" />
        </div>

        <!-- Step 3: Parse Controls -->
        <div class="grid gap-4">
          <div class="flex flex-col md:flex-row gap-4">
            <button id="extract-raw-btn" type="button" class="btn-secondary flex-1 opacity-50 cursor-not-allowed" disabled>
              <span>Extract Raw Text</span>
            </button>
            <button id="parse-structured-btn" type="button" class="btn-primary flex-1 opacity-50 cursor-not-allowed" disabled>
              <span>Parse Structured JSON</span>
            </button>
