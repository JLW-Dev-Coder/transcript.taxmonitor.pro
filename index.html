<!-- index.html -->
<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   
  <title>Transcript.Tax Monitor Pro - IRS Transcript Automation</title>

  <!-- Tailwind (CDN). Yes, we are keeping it. -->
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['DM Sans', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial']
          }
        }
      }
    };
  </script>
   
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.min.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles/site.css?v=1" />
  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />

  <script>
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.10.38/pdf.worker.min.js";
    }
  </script>  
 </head>

 <body class="h-full noise font-sans">
  <div id="app-container" class="h-full overflow-auto">

    <!-- Landing Page -->
   <section id="landing-page" class="page-section active">

    <!-- PARTIAL:header -->

    <!-- Hero Section -->
    <header class="gradient-hero relative min-h-[90%] flex items-center">
     <div class="max-w-7xl mx-auto px-6 py-20 grid lg:grid-cols-2 gap-12 items-center">
      <div class="text-white">
       <div class="counter inline-block mb-6">
        üî• Over 2,000 Tax Pros Trust Us
       </div>
       <h1 id="hero-headline" class="font-display text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6">Transform IRS Transcripts Into Professional Reports in Minutes</h1>
       <p id="hero-subheadline" class="text-xl text-white/80 mb-8 leading-relaxed">The only automation tool tax professionals need to parse, interpret, and present IRS transcript data with beautiful, branded reports your clients will love.</p>
       <div class="flex flex-col sm:flex-row gap-4 mb-8"><button onclick="showPage('lead-magnet')" class="btn-primary text-lg" id="hero-cta"> Get Your Free Guide ‚Üí </button> <button onclick="showPage('sales-page')" class="btn-secondary"> See How It Works </button>
       </div>
       <div class="flex items-center gap-6 text-white/70 text-sm">
        <div class="flex items-center gap-2">
         <svg class="w-5 h-5 text-gold" fill="currentColor" viewbox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
         </svg> No Credit Card Required
        </div>
        <div class="flex items-center gap-2">
         <svg class="w-5 h-5 text-gold" fill="currentColor" viewbox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
         </svg> Instant Access
        </div>
       </div>
      </div>
      <div class="relative hidden lg:block">
       <div class="float-animation">
        <div class="card-elevated p-8 max-w-md mx-auto">
         <div class="flex items-center gap-3 mb-6">
          <div class="w-12 h-12 bg-sage rounded-full flex items-center justify-center text-white text-xl">
           ‚úì
          </div>
          <div>
           <p class="font-bold text-midnight">Report Generated</p>
           <p class="text-sm text-gray-500">Client: Johnson Family Trust</p>
          </div>
         </div>
         <div class="space-y-3">
          <div class="flex justify-between text-sm"><span class="text-gray-600">Transcript Codes Found</span> <span class="font-bold text-midnight">24</span>
          </div>
          <div class="flex justify-between text-sm"><span class="text-gray-600">Interpretation Accuracy</span> <span class="font-bold text-sage">100%</span>
          </div>
          <div class="flex justify-between text-sm"><span class="text-gray-600">Processing Time</span> <span class="font-bold text-midnight">8.3 sec</span>
          </div>
         </div>
         <div class="mt-6 p-4 bg-cream rounded-lg">
          <p class="text-xs text-gray-500 mb-2">Sample Output Preview</p>
          <div class="flex items-center gap-2">
           <div class="w-8 h-8 bg-navy rounded"></div>
           <div class="flex-1">
            <div class="h-2 bg-gray-200 rounded w-3/4 mb-1"></div>
            <div class="h-2 bg-gray-200 rounded w-1/2"></div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </header>
    
    <!-- Pain Points Section -->
    <section class="py-20 bg-white">
     <div class="max-w-7xl mx-auto px-6">
      <div class="text-center max-w-3xl mx-auto mb-16">
       <h2 class="font-display text-3xl md:text-4xl font-bold text-midnight mb-6">Sound Familiar?</h2>
          <p class="text-slate-300 max-w-2xl mx-auto">Handle IRS transcripts long enough and this stops being rare. It becomes routine...</p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="glass rounded-2xl p-8 border border-slate-700/30 h-full flex flex-col">
            <div class="feature-icon mb-6">
              <svg class="w-7 h-7 block" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" preserveAspectRatio="xMidYMid meet">
                <path d="M8 10h8" />
                <path d="M8 14h5" />
                <path d="M21 12a8.5 8.5 0 0 1-8.5 8.5c-1.7 0-3.3-.5-4.7-1.3L3 21l1.8-4.8A8.5 8.5 0 1 1 21 12Z" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-white mb-3">Clients are confused</h3>
            <p class="text-slate-300">They send a transcript and ask, ‚ÄúIs this bad?‚Äù You lose 20 minutes translating codes that should be plain English already, today!!</p>
          </div>

          <div class="glass rounded-2xl p-8 border border-slate-700/30 h-full flex flex-col">
            <div class="feature-icon mb-6">
              <svg class="w-7 h-7 block" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" preserveAspectRatio="xMidYMid meet">
                <path d="M8 6h10" />
                <path d="M8 10h10" />
                <path d="M8 14h6" />
                <path d="M6 6v12a2 2 0 0 0 2 2h10" />
                <path d="M16 18l2 2 4-4" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-white mb-3">You rewrite explanations</h3>
            <p class="text-slate-300">Same transcripts. Same codes. Same explanations. Same copy-paste. Let software do the boring part....</p>
          </div>

          <div class="glass rounded-2xl p-8 border border-slate-700/30 h-full flex flex-col">
            <div class="feature-icon mb-6">
              <svg class="w-7 h-7 block" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" preserveAspectRatio="xMidYMid meet">
                <path d="M7 3h10a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" />
                <path d="M9 7h6" />
                <path d="M9 11h6" />
                <path d="M9 15h4" />
                <path d="M14 15l2 2 4-4" />
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-white mb-3">Intimidating Transcripts</h3>
            <p class="text-slate-300">Even when nothing is wrong. A clean summary of an intimidating transcript builds trust and removes anxiety instantly.</p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Parser Section -->
    <section class="py-20 bg-gradient-to-b from-slate-900 to-slate-800">
     <style>
      /* Client report (shareable) */
      .report-shell { background: rgba(15, 23, 42, 0.55); border: 1px solid rgba(148,163,184,.16); border-radius: 20px; box-shadow: 0 18px 45px rgba(0,0,0,.35); backdrop-filter: blur(10px); }
      .report-page { width: 100%; max-width: 8.5in; margin: 0 auto 24px; background: #ffffff; box-shadow: 0 4px 20px rgba(0,0,0,.10); border-radius: 12px; overflow: hidden; }
      .report-content { padding: 52px; color: #0b0a14; font-family: 'DM Sans', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
      .report-header { display:flex; justify-content:space-between; align-items:flex-start; gap:20px; margin-bottom:40px; padding-bottom:18px; border-bottom:2px solid #0b0a14; }
      .report-h1 { font-size: 30px; font-weight: 800; letter-spacing: -0.5px; line-height:1.1; }
      .report-kicker { font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-top: 6px; }
      .report-logo { max-width: 140px; height: auto; }
      .report-section { margin-bottom: 34px; }
      .report-title { font-size: 13px; font-weight: 800; color: #0b0a14; text-transform: uppercase; letter-spacing: .5px; margin-bottom: 14px; padding-left: 10px; border-left: 4px solid #7c3aed; }
      .report-grid { display:grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
      .report-block { background:#f9fafb; padding: 14px; border-radius: 10px; border-left: 3px solid #7c3aed; }
      .report-label { font-size: 11px; font-weight: 700; color:#6b7280; text-transform: uppercase; letter-spacing:.5px; margin-bottom: 6px; }
      .report-value { font-size: 16px; font-weight: 700; color:#0b0a14; }
      .report-status { display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
      .report-card { background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%); padding: 18px; border-radius: 12px; border: 1px solid #e5e7eb; text-align:center; }
      .report-stat { font-size: 20px; font-weight: 800; margin-bottom: 6px; min-height: 26px; }
      .report-stat.low { color: #059669; }
      .report-stat.moderate { color: #d97706; }
      .report-stat.attention { color: #dc2626; }
      .report-stat-label { font-size: 11px; font-weight: 800; color:#6b7280; text-transform: uppercase; letter-spacing:.5px; }
      .report-summary { background: rgba(124,58,237,.08); border-left: 4px solid #7c3aed; padding: 18px; border-radius: 10px; line-height: 1.7; color:#374151; font-size: 14px; }
      .report-footer { margin-top: 40px; padding-top: 16px; border-top: 1px solid #e5e7eb; display:flex; justify-content:space-between; gap:16px; font-size: 11px; color:#9ca3af; }
      @media (max-width: 640px) {
        .report-content { padding: 28px; }
        .report-grid { grid-template-columns: 1fr; }
        .report-status { grid-template-columns: 1fr; }
      }
      @media print {
        body { background: #fff !important; }
        #chat-root, nav, footer, .toast { display:none !important; }
      }
     </style>
     <div class="max-w-7xl mx-auto px-6">
      <div class="text-center max-w-3xl mx-auto mb-16">
       <h2 class="font-display text-3xl md:text-4xl font-bold text-white mb-6">Try the Transcript Parser</h2>
       <p class="text-xl text-white/80">Upload a transcript PDF. It parses in your browser. No uploads. No risk.</p>
       <p class="text-sm text-white/60 mt-3">Optional: add your firm logo so the preview report looks like <em>your</em> deliverable.</p>
      </div>
      <div class="grid lg:grid-cols-2 gap-12 items-stretch">
        
       <!-- Left: Upload Interface -->
       <div class="bg-slate-800/50 backdrop-blur border border-purple-500/30 rounded-2xl p-8 h-full flex flex-col">
        <div class="space-y-6 flex-1 flex flex-col">
         <div><label class="block text-white/80 text-sm font-medium mb-3">Upload Transcript PDF</label>
         <div class="mt-5">
          <label class="block text-white/80 text-sm font-medium mb-3" for="brand-logo">Firm Logo (Optional)</label>
          <input id="brand-logo" type="file" accept="image/*" class="input-field input-field-light rounded-xl" />
          <p class="text-xs text-white/50 mt-2">Used only for the preview report on this device.</p>
         </div>
          <div class="border-2 border-dashed border-purple-500/50 rounded-xl p-8 text-center hover:border-purple-400/70 transition-colors cursor-pointer bg-purple-500/5">
           <svg class="w-12 h-12 text-purple-400 mx-auto mb-3" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
           </svg>
           <p class="text-white font-medium mb-1">Drop PDF here or click to browse</p>
           <p class="text-white/50 text-sm">Accepts IRS transcripts (Account, Return, Wage &amp; Income)</p>
          </div>
         </div><button class="w-full bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105"> Parse PDF </button>
         <div class="bg-slate-700/50 rounded-lg p-4 border border-slate-600">
          <p class="text-white/70 text-xs flex items-center gap-2">
           <svg class="w-4 h-4 text-green-400" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M5.354 7.146a.5.5 0 010 .708l-3 3a.5.5 0 01-.708 0l-1.5-1.5a.5.5 0 11.708-.708L2 9.293l2.646-2.647a.5.5 0 01.708 0z" clip-rule="evenodd" />
           </svg> Runs locally ‚Ä¢ No PDF uploads</p>
         </div>
        </div>
       </div>
       
       <!-- Right: Preview & Benefits -->
       <div class="space-y-6 h-full flex flex-col">
        <div class="bg-slate-800/50 backdrop-blur border border-purple-500/20 rounded-2xl p-8 flex-1 flex flex-col">
         <div class="flex items-center justify-between mb-4">
          <h3 class="text-white font-bold text-lg">Parsed Report Preview</h3>
          <div class="w-10 h-10 rounded-xl flex items-center justify-center border border-purple-500/30 bg-purple-500/10">
            <svg class="w-5 h-5 text-purple-300" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" preserveAspectRatio="xMidYMid meet">
              <path d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8Z" />
              <path d="M14 2v6h6" />
              <path d="M8 13h8" />
              <path d="M8 17h6" />
              <path d="M17.5 15.5l1 1 2-2" />
            </svg>
          </div>
        </div>
         <div class="space-y-4 text-sm">
          <div class="flex justify-between items-center pb-3 border-b border-slate-700"><span class="text-white/70">Transcript Type</span> <span class="text-white font-medium">Form 4506-C (Account)</span>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-slate-700"><span class="text-white/70">Codes Found</span> <span class="text-purple-400 font-semibold">24 codes</span>
          </div>
          <div class="flex justify-between items-center pb-3 border-b border-slate-700"><span class="text-white/70">Processing Time</span> <span class="text-white font-medium">8.3 seconds</span>
          </div>
          <div class="mt-4 pt-4 border-t border-slate-700">
           <p class="text-white/50 text-xs mb-3">SAMPLE CODES EXTRACTED</p>
           <div class="flex flex-wrap gap-2"><span class="bg-slate-700/60 text-purple-300 px-2 py-1 rounded text-xs font-mono">150</span> <span class="bg-slate-700/60 text-purple-300 px-2 py-1 rounded text-xs font-mono">806</span> <span class="bg-slate-700/60 text-purple-300 px-2 py-1 rounded text-xs font-mono">846</span> <span class="bg-slate-700/60 text-purple-300 px-2 py-1 rounded text-xs font-mono">290</span> <span class="bg-slate-700/60 text-purple-300 px-2 py-1 rounded text-xs font-mono">670</span>
           </div>
          </div>
         </div>
        </div>
        <div class="grid grid-cols-2 gap-4"><button id="preview-report-btn" type="button" class="bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white font-semibold py-3 rounded-lg transition-all flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
          Preview Report
        </button> <button disabled class="bg-slate-700 text-slate-400 font-semibold py-3 rounded-lg cursor-not-allowed opacity-60 flex items-center justify-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg> Download </button>
        </div>
        <div class="bg-purple-600/10 border border-purple-500/30 rounded-lg p-4">
         <p class="text-purple-300 text-sm font-medium mb-2">üîì PREVIEW MODE</p>
         <p class="text-white/70 text-sm">This sample shows the quality of your client-ready reports. Full access unlocks unlimited processing.</p>
        </div>
       </div>
      </div>
     </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="py-20 bg-cream">
      <div class="max-w-7xl mx-auto px-6">
        <div class="text-center max-w-3xl mx-auto mb-12">
          <h2 class="font-display text-3xl md:text-4xl font-bold text-midnight mb-4">üí≥ Pricing</h2>
          <p class="text-gray-600">Buy credits. Use credits to parse transcripts. Humans love complicated systems.</p>

          <!-- Token test controls (parser/dev) -->
          <div class="mt-6 rounded-2xl border border-slate-200 bg-white/60 p-5 text-left">
            <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
              <div class="flex-1">
                <label for="token-id-input" class="block text-xs font-semibold text-gray-600 uppercase tracking-wide">Token ID</label>
                <input id="token-id-input" type="text" placeholder="Paste tokenId here" class="input-field input-field-light mt-2" autocomplete="off" />
                <div id="token-status" class="mt-2 text-xs text-gray-500">Enter a token ID and save it to test balance + parsing credits.</div>
                <div id="pricing-balance" class="hidden mt-2 text-xs text-gray-600"></div>
                <div id="pricing-source" class="hidden mt-1 text-[11px] text-gray-400"></div>
              </div>
              <div class="flex flex-col gap-2 sm:flex-row">
                <button id="save-token-btn" type="button" class="btn-secondary">Save Token</button>
                <button id="refresh-token-btn" type="button" class="btn-primary">View Token Status</button>
                <button id="retry-pricing-btn" type="button" class="btn-secondary">Retry Pricing</button>
              </div>
            </div>

            <div class="mt-4">
              <div class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Saved tokens (this browser)</div>
              <div id="token-list" class="mt-2 flex flex-wrap gap-2"></div>
            </div>

            <details class="mt-4 rounded-xl border border-slate-200 bg-white/60 p-4">
              <summary class="cursor-pointer text-xs font-semibold text-gray-600 uppercase tracking-wide">Diagnostics</summary>
              <div class="mt-3 text-xs text-gray-600">
                <div><span class="font-semibold">Last pricing error:</span> <span id="pricing-last-error">(none)</span></div>
                <div class="mt-1"><span class="font-semibold">Last pricing URL tried:</span> <span id="pricing-last-url">(none)</span></div>
              </div>
            </details>
          </div>
        </div>

        <div id="pricing-grid" class="grid md:grid-cols-3 gap-8">
          <!-- Cards injected by JS -->
          <div class="card-elevated p-8 animate-pulse">
            <div class="h-6 bg-gray-200 rounded w-1/2 mb-3"></div>
            <div class="h-10 bg-gray-200 rounded w-3/4 mb-6"></div>
            <div class="space-y-2 mb-8">
              <div class="h-3 bg-gray-200 rounded"></div>
              <div class="h-3 bg-gray-200 rounded w-5/6"></div>
              <div class="h-3 bg-gray-200 rounded w-2/3"></div>
            </div>
            <div class="h-10 bg-gray-200 rounded"></div>
          </div>
          <div class="card-elevated p-8 animate-pulse hidden md:block">
            <div class="h-6 bg-gray-200 rounded w-1/2 mb-3"></div>
            <div class="h-10 bg-gray-200 rounded w-3/4 mb-6"></div>
            <div class="space-y-2 mb-8">
              <div class="h-3 bg-gray-200 rounded"></div>
              <div class="h-3 bg-gray-200 rounded w-5/6"></div>
              <div class="h-3 bg-gray-200 rounded w-2/3"></div>
            </div>
            <div class="h-10 bg-gray-200 rounded"></div>
          </div>
          <div class="card-elevated p-8 animate-pulse hidden md:block">
            <div class="h-6 bg-gray-200 rounded w-1/2 mb-3"></div>
            <div class="h-10 bg-gray-200 rounded w-3/4 mb-6"></div>
            <div class="space-y-2 mb-8">
              <div class="h-3 bg-gray-200 rounded"></div>
              <div class="h-3 bg-gray-200 rounded w-5/6"></div>
              <div class="h-3 bg-gray-200 rounded w-2/3"></div>
            </div>
            <div class="h-10 bg-gray-200 rounded"></div>
          </div>
        </div>

        <div class="mt-10 text-center text-xs text-gray-500">
          Payments are processed by Stripe. Credits apply instantly after checkout.
        </div>
      </div>

      <script>
        (function () {
          const API_CANDIDATES = [
            "https://api.taxmonitor.pro",
            window.location.origin,
          ].filter(Boolean);

          // --- tiny ‚Äútests‚Äù (in-browser) ---
          function assert(name, condition) {
            if (!condition) {
              console.error("test_failed", name);
              throw new Error(`test_failed:${name}`);
            }
          }

          function runTests() {
            // Alphabetical sort test
            const sorted = ["b", "a", "c"].slice().sort((a, b) => String(a).localeCompare(String(b)));
            assert("alpha_sort", sorted.join("") === "abc");

            // Token storage test (no crash)
            const k = "tmp_tokenId";
            const before = localStorage.getItem(k);
            localStorage.setItem(k, "test-token");
            assert("token_set_get", localStorage.getItem(k) === "test-token");
            if (before === null) localStorage.removeItem(k); else localStorage.setItem(k, before);

            // Money function should return a string
            assert("money_returns_string", typeof money(12900, "USD") === "string");
          }

          function money(amountCents, currency) {
            const amt = Number(amountCents || 0) / 100;
            try {
              return new Intl.NumberFormat(undefined, { style: "currency", currency: String(currency || "USD") }).format(amt);
            } catch {
              return `$${amt.toFixed(2)}`;
            }
          }

          function getPricingDiagnosticsEls() {
            return {
              err: document.getElementById("pricing-last-error"),
              url: document.getElementById("pricing-last-url"),
            };
          }

          function setPricingDiagnostics(lastUrl, err) {
            const els = getPricingDiagnosticsEls();
            if (els.url) els.url.textContent = String(lastUrl || "(none)");
            if (els.err) els.err.textContent = err ? String(err.message || err) : "(none)";
          }

          function getTokenId() {
            const url = new URL(window.location.href);
            const fromQuery = (url.searchParams.get("tokenId") || "").trim();

            // If tokenId is provided in the URL, treat it as authoritative and remember it.
            if (fromQuery) {
              setTokenId(fromQuery);
              return fromQuery;
            }

            const existing = (localStorage.getItem("tmp_tokenId") || "").trim();
            if (existing) return existing;

            const created = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
            setTokenId(created);
            return created;
          }

          async function fetchJson(url, init) {
            // Allows local deterministic testing with window.__TEST_FETCH__.
            if (typeof window.__TEST_FETCH__ === "function") {
              return await window.__TEST_FETCH__(url, init);
            }

            const res = await fetch(url, init);
            const text = await res.text();
            let data;
            try { data = JSON.parse(text); } catch { data = { raw: text }; }
            if (!res.ok) throw new Error(data?.error || data?.message || `Request failed (${res.status})`);
            return data;
          }

          function perksFallback() {
            return [
              "Client-ready report preview",
              "Credits applied instantly",
              "Local PDF parsing (no uploads)",
            ].slice().sort();
          }

          function renderStaticUnavailable() {
            const grid = document.getElementById("pricing-grid");
            if (!grid) return;

            const packs = [
              { credits: 10, recommended: false },
              { credits: 25, recommended: true },
              { credits: 100, recommended: false },
            ];

            grid.innerHTML = packs.map((p) => {
              const featured = Boolean(p.recommended);
              const badge = featured
                ? `<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-purple-600 text-white">Most popular</div>`
                : `<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-slate-900/5 text-slate-700">Credits pack</div>`;

              const cardClass = featured
                ? "card-elevated p-8 border-2 border-purple-500/30 relative"
                : "card-elevated p-8";

              return `
                <div class="${cardClass}">
                  <div class="flex items-center justify-between mb-5">
                    ${badge}
                    <div class="text-xs text-gray-500">Transcript.Tax Monitor Pro</div>
                  </div>

                  <div class="mb-5">
                    <div class="text-4xl font-extrabold text-midnight leading-none">${Number(p.credits)}</div>
                    <div class="text-sm text-gray-600 mt-1">credits</div>
                  </div>

                  <div class="mb-6">
                    <div class="text-2xl font-bold text-midnight">Pricing unavailable</div>
                    <div class="text-xs text-gray-500 mt-1">service is temporarily down</div>
                  </div>

                  <ul class="space-y-2 text-sm text-gray-700 mb-8">
                    ${perksFallback().map((perk) => `<li class="flex items-start gap-2"><span class="text-purple-600">‚úì</span><span>${perk}</span></li>`).join("")}
                  </ul>

                  <button class="btn-secondary w-full text-center" disabled>
                    Checkout unavailable
                  </button>

                  <div class="mt-3 text-xs text-gray-500">
                    Click ‚ÄúRetry Pricing‚Äù when the API is back.
                  </div>
                </div>
              `;
            }).join("");
          }

          function renderTokenList(activeTokenId) {
            const wrap = document.getElementById("token-list");
            if (!wrap) return;

            const saved = loadSavedTokens();
            if (!saved.length) {
              wrap.innerHTML = `<div class="text-xs text-gray-400">No saved tokens yet.</div>`;
              return;
            }

            const items = saved.slice().sort((a, b) => String(a).localeCompare(String(b)));
            wrap.innerHTML = items.map((t) => {
              const isActive = String(t) === String(activeTokenId);
              const cls = isActive
                ? "inline-flex items-center gap-2 rounded-full bg-purple-600 px-3 py-1 text-xs font-semibold text-white"
                : "inline-flex items-center gap-2 rounded-full border border-slate-300 bg-white px-3 py-1 text-xs font-semibold text-slate-700 hover:border-purple-400";

              const label = String(t).length > 12 ? `${String(t).slice(0, 8)}‚Ä¶${String(t).slice(-4)}` : String(t);
              return `<button type="button" class="${cls}" data-token="${String(t).replaceAll('"','&quot;')}">${label}</button>`;
            }).join("");

            wrap.querySelectorAll("button[data-token]").forEach((btn) => {
              btn.addEventListener("click", () => {
                const next = String(btn.getAttribute("data-token") || "").trim();
                if (!next) return;
                setTokenId(next);
                syncTokenUI();
                loadBalance();
              });
            });
          }

          function loadSavedTokens() {
            try {
              const raw = localStorage.getItem("tmp_tokenIds") || "[]";
              const arr = JSON.parse(raw);
              return Array.isArray(arr) ? arr.map((x) => String(x).trim()).filter(Boolean) : [];
            } catch {
              return [];
            }
          }

          function saveTokenId(tokenId) {
            const cleaned = String(tokenId || "").trim();
            if (!cleaned) return false;

            const next = Array.from(new Set([cleaned, ...loadSavedTokens()])).filter(Boolean);
            localStorage.setItem("tmp_tokenIds", JSON.stringify(next));
            return true;
          }

          function setTokenId(tokenId) {
            const cleaned = String(tokenId || "").trim();
            if (!cleaned) return;
            localStorage.setItem("tmp_tokenId", cleaned);
            saveTokenId(cleaned);
          }

          function setTokenStatus(text, tone) {
            const el = document.getElementById("token-status");
            if (!el) return;
            el.textContent = String(text || "");
            el.className = "mt-2 text-xs " + (tone === "error" ? "text-red-600" : tone === "ok" ? "text-green-700" : "text-gray-500");
          }

          function syncTokenUI() {
            const tokenId = (localStorage.getItem("tmp_tokenId") || "").trim();
            const input = document.getElementById("token-id-input");
            if (input && String(input.value || "").trim() !== tokenId) input.value = tokenId;
            renderTokenList(tokenId);
          }

          function renderCards(prices) {
            const grid = document.getElementById("pricing-grid");
            if (!grid) return;

            const sorted = Array.isArray(prices)
              ? prices.slice().sort((a, b) => (Number(a.credits || 0) - Number(b.credits || 0)))
              : [];

            const fallback = perksFallback();

            grid.innerHTML = sorted.map((p) => {
              const perks = Array.isArray(p.perks) && p.perks.length ? p.perks.slice().sort() : fallback;
              const featured = Boolean(p.recommended);

              const badge = featured
                ? `<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-purple-600 text-white">Most popular</div>`
                : `<div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold bg-slate-900/5 text-slate-700">Credits pack</div>`;

              const cardClass = featured
                ? "card-elevated p-8 border-2 border-purple-500/30 relative"
                : "card-elevated p-8";

              const ctaClass = featured
                ? "btn-primary w-full text-center"
                : "btn-secondary w-full text-center";

              return `
                <div class="${cardClass}">
                  <div class="flex items-center justify-between mb-5">
                    ${badge}
                    <div class="text-xs text-gray-500">${String(p.label || "Transcript.Tax Monitor Pro")}</div>
                  </div>

                  <div class="mb-5">
                    <div class="text-4xl font-extrabold text-midnight leading-none">${Number(p.credits || 0)}</div>
                    <div class="text-sm text-gray-600 mt-1">credits</div>
                  </div>

                  <div class="mb-6">
                    <div class="text-2xl font-bold text-midnight">${money(p.amount, p.currency)}</div>
                    <div class="text-xs text-gray-500 mt-1">one-time purchase</div>
                  </div>

                  <ul class="space-y-2 text-sm text-gray-700 mb-8">
                    ${perks.map((perk) => `<li class="flex items-start gap-2"><span class="text-purple-600">‚úì</span><span>${perk}</span></li>`).join("")}
                  </ul>

                  <button class="${ctaClass}" data-price-id="${String(p.priceId || "")}">
                    Buy credits
                  </button>

                  <div class="mt-3 text-xs text-gray-500">
                    Uses your saved token ID for instant crediting.
                  </div>
                </div>
              `;
            }).join("");

            grid.querySelectorAll("button[data-price-id]").forEach((btn) => {
              btn.addEventListener("click", async () => {
                const priceId = String(btn.getAttribute("data-price-id") || "").trim();
                if (!priceId) return;

                btn.disabled = true;
                const original = btn.textContent;
                btn.textContent = "Redirecting...";

                try {
                  const tokenId = getTokenId();

                  const checkoutCandidates = ["https://api.taxmonitor.pro", window.location.origin].filter(Boolean).sort();
                  let checkoutOut = null;
                  let lastErr = null;

                  for (const base of checkoutCandidates) {
                    try {
                      checkoutOut = await fetchJson(`${base}/transcript/checkout`, {
                        method: "POST",
                        headers: { "content-type": "application/json" },
                        body: JSON.stringify({ priceId, tokenId }),
                      });
                      lastErr = null;
                      break;
                    } catch (e) {
                      lastErr = e;
                    }
                  }

                  if (checkoutOut && checkoutOut.url) {
                    window.location.href = checkoutOut.url;
                    return;
                  }

                  throw lastErr || new Error("Missing checkout URL");
                } catch (err) {
                  console.error("checkout_failed", err);
                  alert("Checkout failed. Try again.");
                } finally {
                  btn.disabled = false;
                  btn.textContent = original;
                }
              });
            });
          }

          async function loadBalance() {
            const el = document.getElementById("pricing-balance");
            if (!el) return;

            try {
              const tokenId = getTokenId();

              const tokenCandidates = ["https://api.taxmonitor.pro", window.location.origin].filter(Boolean).sort();
              let out = null;
              let lastUrl = null;

              for (const base of tokenCandidates) {
                lastUrl = `${base}/transcript/tokens?tokenId=${encodeURIComponent(tokenId)}`;
                try {
                  out = await fetchJson(lastUrl);
                  break;
                } catch {
                  // continue
                }
              }

              const balance = Number(out?.balance || 0);
              el.textContent = `Your current balance: ${balance} credits`;
              el.classList.remove("hidden");
              setTokenStatus(`Token status: ${balance} credits available`, "ok");
              setPricingDiagnostics(lastUrl, null);
            } catch (e) {
              setTokenStatus("Token status: unavailable (API not reachable)", "error");
              setPricingDiagnostics(null, e);
            }
          }

          async function fetchPricingWithFallback() {
            const candidates = API_CANDIDATES.slice().sort();
            let lastErr = null;
            let lastUrl = null;

            for (const base of candidates) {
              lastUrl = `${base}/transcript/prices`;
              try {
                const out = await fetchJson(lastUrl, { method: "GET" });
                return { ok: true, base, out, lastUrl };
              } catch (e) {
                lastErr = e;
              }
            }

            return { ok: false, error: lastErr, lastUrl };
          }

          async function initPricing() {
            const sourceEl = document.getElementById("pricing-source");

            // IMPORTANT: This function must never throw.
            // Some other runtime is apparently angry when it sees pricing_load_failed.
            try {
              const result = await fetchPricingWithFallback();

              if (!result.ok) {
                console.warn("pricing_unavailable", result.error);
                renderStaticUnavailable();
                if (sourceEl) {
                  sourceEl.textContent = "Pricing source: unavailable";
                  sourceEl.classList.remove("hidden");
                }
                setPricingDiagnostics(result.lastUrl, result.error || new Error("pricing_unavailable"));
                return;
              }

              renderCards(result.out?.prices || []);
              if (sourceEl) {
                sourceEl.textContent = `Pricing source: ${result.base}`;
                sourceEl.classList.remove("hidden");
              }
              setPricingDiagnostics(result.lastUrl, null);

              // Balance is optional; do not let it take down pricing.
              await loadBalance();
            } catch (err) {
              console.error("pricing_init_failed", err);
              renderStaticUnavailable();
              if (sourceEl) {
                sourceEl.textContent = "Pricing source: unavailable";
                sourceEl.classList.remove("hidden");
              }
              setPricingDiagnostics(null, err);
            }
          }

          function initTokenControls() {
            const input = document.getElementById("token-id-input");
            const retryPricingBtn = document.getElementById("retry-pricing-btn");
            const saveBtn = document.getElementById("save-token-btn");
            const refreshBtn = document.getElementById("refresh-token-btn");

            syncTokenUI();

            if (retryPricingBtn) {
              retryPricingBtn.addEventListener("click", async () => {
                retryPricingBtn.disabled = true;
                const original = retryPricingBtn.textContent;
                retryPricingBtn.textContent = "Retrying‚Ä¶";
                try {
                  await initPricing();
                } finally {
                  retryPricingBtn.disabled = false;
                  retryPricingBtn.textContent = original;
                }
              });
            }

            if (saveBtn) {
              saveBtn.addEventListener("click", () => {
                const val = String(input?.value || "").trim();
                if (!val) {
                  setTokenStatus("Token ID is empty. Humans never fail to amaze.", "error");
                  return;
                }
                setTokenId(val);
                syncTokenUI();
                setTokenStatus("Token saved.", "ok");
              });
            }

            if (refreshBtn) {
              refreshBtn.addEventListener("click", async () => {
                const val = String(input?.value || "").trim();
                if (val) setTokenId(val);
                syncTokenUI();
                setTokenStatus("Checking token status‚Ä¶", "neutral");
                await loadBalance();
              });
            }

            if (input) {
              input.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                  e.preventDefault();
                  refreshBtn?.click();
                }
              });
            }
          }

          async function initAll() {
            // Tests should not run in production unless explicitly asked.
            const url = new URL(window.location.href);
            const run = String(url.searchParams.get("runTests") || "").trim().toLowerCase();
            if (run === "1" || run === "true") runTests();

            initTokenControls();
            await initPricing();
          }

          if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initAll);
          } else {
            initAll();
          }
        })();
      </script>
    </section>

    <section class="py-20 gradient-hero">
     <div class="max-w-4xl mx-auto px-6 text-center">
      <h2 class="font-display text-3xl md:text-4xl font-bold text-white mb-6">Ready to Transform Your Transcript Workflow?</h2>
      <p class="text-xl text-white/80 mb-8">Join thousands of tax professionals who've reclaimed their time and impressed their clients.</p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center"><button onclick="showPage('lead-magnet')" class="btn-primary text-lg"> Get Your Free Guide First ‚Üí </button> <button onclick="showPage('sales-page')" class="btn-secondary"> Skip to Purchase </button>
      </div>
     </div>
    </section>

    <!-- PARTIAL:footer -->

   </section>
   
   <!-- Lead Magnet Page -->
   <section id="lead-magnet" class="page-section">
    <div class="min-h-full gradient-hero flex items-center py-12">
     <div class="max-w-6xl mx-auto px-6 grid lg:grid-cols-2 gap-12 items-center">
      <div class="text-white"><button onclick="showPage('landing-page')" class="flex items-center gap-2 text-white/70 hover:text-white mb-8 transition-colors">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg> Back to Home </button>
       <div class="counter inline-block mb-4">
        üìö FREE DOWNLOAD
       </div>
       <h1 class="font-display text-3xl md:text-4xl lg:text-5xl font-bold leading-tight mb-6">The Ultimate Guide to IRS Transcript Codes</h1>
       <p class="text-xl text-white/80 mb-8">Stop guessing what those cryptic codes mean. Our comprehensive 32-page guide breaks down every transcript code you'll encounter, complete with real-world examples and action steps.</p>
       <div class="space-y-4 mb-8">
        <div class="check-item">
         <div class="check-icon">
          ‚úì
         </div>
         <div>
          <p class="font-semibold">Complete Code Reference</p>
          <p class="text-white/70 text-sm">All 150+ IRS transcript codes explained in plain English</p>
         </div>
        </div>
        <div class="check-item">
         <div class="check-icon">
          ‚úì
         </div>
         <div>
          <p class="font-semibold">Real Client Scenarios</p>
          <p class="text-white/70 text-sm">See how codes appear in actual transcripts with annotations</p>
         </div>
        </div>
        <div class="check-item">
         <div class="check-icon">
          ‚úì
         </div>
         <div>
          <p class="font-semibold">Quick Reference Chart</p>
          <p class="text-white/70 text-sm">Printable cheat sheet for your desk</p>
         </div>
        </div>
        <div class="check-item">
         <div class="check-icon">
          ‚úì
         </div>
         <div>
          <p class="font-semibold">Red Flag Alerts</p>
          <p class="text-white/70 text-sm">Codes that require immediate attention highlighted</p>
         </div>
        </div>
       </div>
      </div>
      <div class="card-elevated p-8 max-w-md mx-auto w-full">
       <h3 class="font-display text-2xl font-bold text-midnight text-center mb-2">Get Instant Access</h3>
       <p class="text-gray-500 text-center mb-6">Enter your details below</p>
       <form id="lead-form" class="space-y-4">
        <div><label for="lead-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label> <input type="text" id="lead-name" placeholder="John Smith" class="input-field input-field-light" required>
        </div>
        <div><label for="lead-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label> <input type="email" id="lead-email" placeholder="john@taxfirm.com" class="input-field input-field-light" required>
        </div>
        <div><label for="lead-firm" class="block text-sm font-medium text-gray-700 mb-1">Firm Name (Optional)</label> <input type="text" id="lead-firm" placeholder="Smith Tax Services" class="input-field input-field-light">
        </div><button type="submit" id="lead-submit-btn" class="btn-primary w-full text-center"> Download Free Guide ‚Üí </button>
        <p class="text-xs text-gray-400 text-center">We respect your privacy. Unsubscribe anytime.</p>
       </form>
      </div>
     </div>
    </div>
   </section>
   
  <!-- Toast Container -->
  <div id="toast-container"></div>

  <!-- Cal element-click embed code begins -->
  <script type="text/javascript">
    (function (C, A, L) {
      let p = function (a, ar) { a.q.push(ar); };
      let d = C.document;
      C.Cal = C.Cal || function () {
        let cal = C.Cal;
        let ar = arguments;
        if (!cal.loaded) {
          cal.ns = {};
          cal.q = cal.q || [];
          d.head.appendChild(d.createElement("script")).src = A;
          cal.loaded = true;
        }
        if (ar[0] === L) {
          const api = function () { p(api, arguments); };
          const namespace = ar[1];
          api.q = api.q || [];
          if (typeof namespace === "string") {
            cal.ns[namespace] = cal.ns[namespace] || api;
            p(cal.ns[namespace], ar);
            p(cal, ["initNamespace", namespace]);
          } else p(cal, ar);
          return;
        }
        p(cal, ar);
      };
    })(window, "https://app.cal.com/embed/embed.js", "init");

    Cal("init", "tax-monitor-transcript-support", { origin: "https://app.cal.com" });

    Cal.ns["tax-monitor-transcript-support"]("ui", {
      cssVarsPerTheme: {
        light: { "cal-brand": "#a855f7" },
        dark: { "cal-brand": "#a855f7" }
      },
      hideEventTypeDetails: false,
      layout: "month_view"
    });
  </script>
  <!-- Cal element-click embed code ends -->

  <!-- CAL.COM FLOATING SUPPORT -->
  <script type="text/javascript" id="cal-embed-loader">
    (function (C, A, L) { let p = function (a, ar) { a.q.push(ar); }; let d = C.document; C.Cal = C.Cal || function () { let cal = C.Cal; let ar = arguments; if (!cal.loaded) { cal.ns = {}; cal.q = cal.q || []; d.head.appendChild(d.createElement("script")).src = A; cal.loaded = true; } if (ar[0] === L) { const api = function () { p(api, arguments); }; const namespace = ar[1]; api.q = api.q || []; if(typeof namespace === "string"){cal.ns[namespace] = cal.ns[namespace] || api;p(cal.ns[namespace], ar);p(cal, ["initNamespace", namespace]);} else p(cal, ar); return;} p(cal, ar); }; })(window, "https://app.cal.com/embed/embed.js", "init");
  </script>

  <script type="text/javascript" id="cal-embed-config">
    Cal("init", "tax-monitor-transcript-support", {origin:"https://app.cal.com"});

    Cal.ns["tax-monitor-transcript-support"]("floatingButton", {
      "calLink":"tax-monitor-pro/tax-monitor-transcript-support",
      "config":{
        "layout":"month_view",
        "useSlotsViewOnSmallScreen":"true"
      },
      "buttonText":"Book Transcript Support"
    });

    Cal.ns["tax-monitor-transcript-support"]("ui", {
      "cssVarsPerTheme":{
        "light":{"cal-brand":"#292929"},
        "dark":{"cal-brand":"#f97316"}
      },
      "hideEventTypeDetails":false,
      "layout":"month_view"
    });
  </script>
  <!-- END CAL.COM FLOATING SUPPORT -->
   
</body>
</html>
